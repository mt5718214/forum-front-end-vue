(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-717a5a56"],{"293a":function(e,t,s){"use strict";s.r(t);var r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chat-main"},[s("div",{staticClass:"chat-container p-5"},[s("Chatroom")],1)])},n=[],a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"chat-room"},[s("div",{staticClass:"chat-users"},[s("div",{staticClass:"title"},[e._v(" 上線使用者 ("+e._s(e.onlineUsers?e.onlineUsers.length:0)+") ")]),e.onlineUsers.length>0?s("div",{staticClass:"list-group"},e._l(e.onlineUsers,(function(t){return s("div",{key:""+(t.id+Math.random()),staticClass:"list-group-item"},[s("div",{staticClass:"avatar",style:{background:"url("+t.image+") no-repeat center/cover"},on:{click:function(s){e.$router.push("/users/"+t.id).catch((function(){}))}}}),s("div",{staticClass:"info"},[s("div",{staticClass:"name",on:{click:function(s){e.$router.push("/users/"+t.id).catch((function(){}))}}},[e._v(" "+e._s(t.name)+" ")])])])})),0):e._e()]),s("MessengeBoard")],1)},i=[],c=s("5530"),o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.$refs?s("div",{staticClass:"messenge-board"},[e._m(0),s("div",{ref:"boardWrapper",staticClass:"board-wrapper"},[s("div",{staticClass:"messages"},e._l(e.messages,(function(t,r){return s("div",{key:"msg-"+r},["userComein"===t.type&&e.currentUser.id!==t.UserId?s("div",{staticClass:"broacast-message-wrapper"},[s("div",{staticClass:"broacast-message"},[e._v(e._s(t.message))])]):e._e(),"userComein"!==t.type&&e.currentUser.id!==t.UserId?s("div",{staticClass:"other message"},[s("div",{staticClass:"avatar",style:{background:"url("+t.image+") no-repeat center/cover"}}),s("div",{staticClass:"wrapper"},[s("div",{staticClass:"text"},[e._v(e._s(t.message))]),s("div",{staticClass:"time"},[e._v(e._s(e._f("fromNow")(t.createdAt)))])])]):e._e(),"userComein"!==t.type&&e.currentUser.id===t.UserId?s("div",{staticClass:"self message"},[s("div",{staticClass:"text"},[e._v(e._s(t.message))]),s("div",{staticClass:"time"},[e._v(e._s(e._f("fromNow")(t.createdAt)))])]):e._e()])})),0)]),s("form",{on:{submit:function(t){return t.preventDefault(),e.sendMessage.apply(null,arguments)}}},[s("div",{staticClass:"text-wrapper"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],staticClass:"text",attrs:{placeholder:"輸入訊息...",onfocus:"this.placeholder = ''",onblur:"this.placeholder = '輸入訊息...'"},domProps:{value:e.message},on:{input:function(t){t.target.composing||(e.message=t.target.value)}}}),s("div",{staticClass:"icon-wrapper",attrs:{type:"submit"},on:{click:function(t){return t.stopPropagation(),t.preventDefault(),e.sendMessage.apply(null,arguments)}}},[s("div",{staticClass:"bi-send"},[e._v("送出")])])])])]):e._e()},u=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"top-wrapper"},[s("div",{staticClass:"public-text"},[e._v("公開聊天室")])])}],l=s("1da1"),m=(s("96cf"),s("498a"),s("b0c0"),s("2f62")),d=s("2fa3"),v=s("2708"),p={data:function(){return{message:"",messages:[]}},mixins:[v["b"]],methods:{sendMessage:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.message.trim()){t.next=3;break}return d["a"].fire({icon:"warning",title:"請輸入訊息"}),t.abrupt("return");case 3:e.$socket.emit("send message",{UserId:e.currentUser.id,avatar:e.currentUser.avatar,message:e.message,createdAt:new Date,type:"chat",User:e.currentUser}),e.message="";case 5:case"end":return t.stop()}}),t)})))()},fetchChatroom:function(){return Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},leaveChatroom:function(){var e=this;return Object(l["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$socket.emit();case 1:case"end":return t.stop()}}),t)})))()}},watch:{messages:function(){return this.messages}},mounted:function(){var e=this;this.$socket.emit("joinRoom",this.currentUser),this.$socket.on("newUser",(function(t){var s=t.newUser,r=t.onlineUsers;e.$store.commit("addOnlineUsers",{newUser:s,onlineUsers:r})})),this.$socket.on("msg",(function(t){return e.messages.push(t)})),this.$socket.emit("get history",{namespace:"public"}),this.$socket.once("history",(function(t){return e.messages=t})),this.$socket.on("leave",(function(t){e.$store.commit("removeOnlineUsers",t),console.log("".concat(t.name," leaved"))}))},beforeDestroy:function(){this.$socket.emit("leave",this.currentUser.id)},created:function(){window.addEventListener("beforeunload",this.leaveChatroom())},computed:Object(c["a"])({},Object(m["b"])(["currentUser","isAuthenticated"]))},f=p,h=(s("37e1"),s("2877")),g=Object(h["a"])(f,o,u,!1,null,null,null),C=g.exports,b={name:"Chatroom",computed:Object(c["a"])({},Object(m["b"])(["currentUser","onlineUsers"])),components:{MessengeBoard:C}},_=b,w=(s("e92d"),Object(h["a"])(_,a,i,!1,null,"9cb15bb6",null)),U=w.exports,k={name:"Chat",components:{Chatroom:U}},$=k,x=Object(h["a"])($,r,n,!1,null,null,null);t["default"]=x.exports},"37e1":function(e,t,s){"use strict";s("cc4d")},"498a":function(e,t,s){"use strict";var r=s("23e7"),n=s("58a8").trim,a=s("c8d2");r({target:"String",proto:!0,forced:a("trim")},{trim:function(){return n(this)}})},"67d0":function(e,t,s){},c8d2:function(e,t,s){var r=s("5e77").PROPER,n=s("d039"),a=s("5899"),i="​᠎";e.exports=function(e){return n((function(){return!!a[e]()||i[e]()!==i||r&&a[e].name!==e}))}},cc4d:function(e,t,s){},e92d:function(e,t,s){"use strict";s("67d0")}}]);
//# sourceMappingURL=chunk-717a5a56.b2b2bf28.js.map